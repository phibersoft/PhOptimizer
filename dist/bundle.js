#!/usr/bin/env node
(()=>{"use strict";var e={519:function(e,t,i){var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(o,n){function s(e){try{l(r.next(e))}catch(e){n(e)}}function a(e){try{l(r.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,a)}l((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const o=i(12),n=i(515),s=i(189),a=i(22),l=i(955),c=i(147),d=i(461),u=new n.ArgumentParser({description:"Phoptimizator is a simple image optimizator from -cli."});u.add_argument("-v","--version",{action:"version",version:i(598).i8}),u.add_argument("-f","--file",{help:"Image name on current path. Example: xxx.jpg",default:"ALL"}),u.add_argument("-p","--path",{help:"Image path destination. Default: process.cwd()",default:process.cwd()}),u.add_argument("-q","--quality",{help:"Image quality. Default: 70",default:70}),u.add_argument("-he","--height",{help:"Image height. Default: AUTO",default:o.AUTO}),u.add_argument("-w","--width",{help:"Image width. Default: 1920",default:1920}),u.add_argument("-o","--overwrite",{help:"Overwrite. If you set this option, optimized image overwrites original file with same name.",default:!1});const p=u.parse_args(),h=["jpg","jpeg","png","tif","gif","bmp"],f=(e,t,i,n,s=o.AUTO,a)=>r(void 0,void 0,void 0,(function*(){var r=yield o.read(`${e}\\${t}`),l=s===o.AUTO?o.AUTO:Number(s);if(yield r.resize(n,l),yield r.quality(a),!1===i){const i=t.split("."),o=i.slice(0,i.length-1).join("."),n=`${e}\\${o}_optimized.jpeg`;yield r.writeAsync(n)}else yield r.writeAsync(`${e}\\${t}`)})),g=e=>{console.log(["\n",a.redBright(e),"\n"].join("")),process.exit()};r(void 0,void 0,void 0,(function*(){try{var e="Options: \n";e+=Object.keys(p).map((e=>a.cyanBright(`${e} = ${p[e]}`))).join("\n"),e+="\nDo you confirm (y/n)? ";const t=(0,s.createInterface)({input:process.stdin,output:process.stdout});t.question(e,(e=>r(void 0,void 0,void 0,(function*(){if("y"==e||"Y"===e)if("ALL"===p.file)c.readdir(p.path,((e,i)=>r(void 0,void 0,void 0,(function*(){for(var e=[],o=0;o<i.length;o++){const t=i[o],r=t.split("."),n=r[r.length-1];h.includes(n)&&e.push(t)}0===e.length&&g(`No files found with type: ${h.join(",")}`);const n="\nFiles:\n"+a.blueBright(e.join("\n"))+"\nDo you confirm(y/n)? ";t.question(n,(t=>r(void 0,void 0,void 0,(function*(){if(t.startsWith("y")||t.startsWith("Y")){const t=l.default.dots;let r=0;for(var i=0;i<e.length;i++){const o=e[i],n=` Optimizing (${i+1}/${e.length}) : ${o}`,s=setInterval((()=>{const{frames:e}=t;d(e[r=++r%e.length]+a.yellowBright(n))}),t.interval);yield f(p.path,o,p.overwrite,Number(p.width),p.height,Number(p.quality)),clearInterval(s)}console.log(a.greenBright("Process finished.")),process.exit(1)}else g("User cancelled process")}))))}))));else{const e=l.default.dots;let t=0;const i=setInterval((()=>{const{frames:i}=e;d(i[t=++t%i.length]+`Optimizing ${a.yellowBright(p.file)}`)}),e.interval);yield f(p.path,p.file,p.overwrite,Number(p.width),p.height,Number(p.quality)),clearInterval(i),console.log(a.greenBright("Process finished.")),process.exit()}else g("User cancelled process.")}))))}catch(e){console.log(a.redBright(`Unexpected Error: ${e.message}`)),process.exit(1)}}))},515:e=>{e.exports=require("argparse")},22:e=>{e.exports=require("chalk")},955:e=>{e.exports=require("cli-spinners")},12:e=>{e.exports=require("jimp")},461:e=>{e.exports=require("log-update")},189:e=>{e.exports=require("readline")},147:e=>{e.exports=require("fs")},598:e=>{e.exports={i8:"1.0.0"}}},t={};!function i(r){var o=t[r];if(void 0!==o)return o.exports;var n=t[r]={exports:{}};return e[r].call(n.exports,n,n.exports,i),n.exports}(519)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q0F6QkYsRUFBT0MsUUFBVUMsUUFBUSxpQixPQ0F6QkYsRUFBT0MsUUFBVUMsUUFBUSxTLFFDQXpCRixFQUFPQyxRQUFVQyxRQUFRLGUsUUNBekJGLEVBQU9DLFFBQVVDLFFBQVEsYSxRQ0F6QkYsRUFBT0MsUUFBVUMsUUFBUSxPLGlDQ0NyQkMsRUFBMkIsSUFHL0IsU0FBU0MsRUFBb0JDLEdBRTVCLElBQUlDLEVBQWVILEVBQXlCRSxHQUM1QyxRQUFxQkUsSUFBakJELEVBQ0gsT0FBT0EsRUFBYUwsUUFHckIsSUFBSUQsRUFBU0csRUFBeUJFLEdBQVksQ0FHakRKLFFBQVMsSUFPVixPQUhBTyxFQUFvQkgsR0FBVUksS0FBS1QsRUFBT0MsUUFBU0QsRUFBUUEsRUFBT0MsUUFBU0csR0FHcEVKLEVBQU9DLFFDbEJXRyxDQUFvQixNIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vcGhvcHRpbWl6ZXIvLi9zcmMvbWFpbi50cyIsIndlYnBhY2s6Ly9waG9wdGltaXplci9leHRlcm5hbCBjb21tb25qcyBcImFyZ3BhcnNlXCIiLCJ3ZWJwYWNrOi8vcGhvcHRpbWl6ZXIvZXh0ZXJuYWwgY29tbW9uanMgXCJjaGFsa1wiIiwid2VicGFjazovL3Bob3B0aW1pemVyL2V4dGVybmFsIGNvbW1vbmpzIFwiY2xpLXNwaW5uZXJzXCIiLCJ3ZWJwYWNrOi8vcGhvcHRpbWl6ZXIvZXh0ZXJuYWwgY29tbW9uanMgXCJqaW1wXCIiLCJ3ZWJwYWNrOi8vcGhvcHRpbWl6ZXIvZXh0ZXJuYWwgY29tbW9uanMgXCJsb2ctdXBkYXRlXCIiLCJ3ZWJwYWNrOi8vcGhvcHRpbWl6ZXIvZXh0ZXJuYWwgY29tbW9uanMgXCJyZWFkbGluZVwiIiwid2VicGFjazovL3Bob3B0aW1pemVyL2V4dGVybmFsIG5vZGUtY29tbW9uanMgXCJmc1wiIiwid2VicGFjazovL3Bob3B0aW1pemVyL3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovL3Bob3B0aW1pemVyL3dlYnBhY2svc3RhcnR1cCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBKaW1wIGZyb20gXCJqaW1wXCI7XHJcbmltcG9ydCB7QXJndW1lbnRQYXJzZXJ9IGZyb20gXCJhcmdwYXJzZVwiO1xyXG5pbXBvcnQge2NyZWF0ZUludGVyZmFjZX0gZnJvbSBcInJlYWRsaW5lXCI7XHJcbmltcG9ydCAqIGFzIGNoYWxrIGZyb20gXCJjaGFsa1wiO1xyXG5pbXBvcnQgY2xpU3Bpbm5lcnMgZnJvbSBcImNsaS1zcGlubmVyc1wiO1xyXG5pbXBvcnQgKiBhcyBmcyBmcm9tIFwiZnNcIjtcclxuY29uc3QgbG9nVXBkYXRlID0gcmVxdWlyZSgnbG9nLXVwZGF0ZScpO1xyXG5cclxuY29uc3QgcGFyc2VyID0gbmV3IEFyZ3VtZW50UGFyc2VyKHtcclxuICAgIGRlc2NyaXB0aW9uOiAnUGhvcHRpbWl6YXRvciBpcyBhIHNpbXBsZSBpbWFnZSBvcHRpbWl6YXRvciBmcm9tIC1jbGkuJyxcclxufSk7XHJcblxyXG5wYXJzZXIuYWRkX2FyZ3VtZW50KCctdicsICctLXZlcnNpb24nLCB7YWN0aW9uOiAndmVyc2lvbicsIHZlcnNpb246IHJlcXVpcmUoJy4vLi4vcGFja2FnZS5qc29uJykudmVyc2lvbn0pO1xyXG5wYXJzZXIuYWRkX2FyZ3VtZW50KCctZicsICctLWZpbGUnLCB7aGVscDogJ0ltYWdlIG5hbWUgb24gY3VycmVudCBwYXRoLiBFeGFtcGxlOiB4eHguanBnJywgZGVmYXVsdDogJ0FMTCcgfSk7XHJcbnBhcnNlci5hZGRfYXJndW1lbnQoJy1wJywgJy0tcGF0aCcsIHtoZWxwOiAnSW1hZ2UgcGF0aCBkZXN0aW5hdGlvbi4gRGVmYXVsdDogcHJvY2Vzcy5jd2QoKScsIGRlZmF1bHQ6IHByb2Nlc3MuY3dkKCl9KTtcclxucGFyc2VyLmFkZF9hcmd1bWVudCgnLXEnLCAnLS1xdWFsaXR5Jywge2hlbHA6ICdJbWFnZSBxdWFsaXR5LiBEZWZhdWx0OiA3MCcsIGRlZmF1bHQ6IDcwfSk7XHJcbnBhcnNlci5hZGRfYXJndW1lbnQoJy1oZScsICctLWhlaWdodCcsIHtoZWxwOiAnSW1hZ2UgaGVpZ2h0LiBEZWZhdWx0OiBBVVRPJywgZGVmYXVsdDogSmltcC5BVVRPfSk7XHJcbnBhcnNlci5hZGRfYXJndW1lbnQoJy13JywgJy0td2lkdGgnLCB7aGVscDogJ0ltYWdlIHdpZHRoLiBEZWZhdWx0OiAxOTIwJywgZGVmYXVsdDogMTkyMH0pO1xyXG5wYXJzZXIuYWRkX2FyZ3VtZW50KCctbycsICctLW92ZXJ3cml0ZScsIHtoZWxwOiAnT3ZlcndyaXRlLiBJZiB5b3Ugc2V0IHRoaXMgb3B0aW9uLCBvcHRpbWl6ZWQgaW1hZ2Ugb3ZlcndyaXRlcyBvcmlnaW5hbCBmaWxlIHdpdGggc2FtZSBuYW1lLicsIGRlZmF1bHQ6IGZhbHNlfSk7XHJcblxyXG5jb25zdCBvcHRzID0gcGFyc2VyLnBhcnNlX2FyZ3MoKTtcclxuY29uc3Qgc3VwcG9ydGVkX3R5cGVzID0gWydqcGcnLCAnanBlZycsICdwbmcnLCAndGlmJywgJ2dpZicsICdibXAnXTtcclxuXHJcblxyXG5jb25zdCBvcHRpbWl6ZXIgPSBhc3luYyAocGF0aDogc3RyaW5nLCBpbWFnZU5hbWU6IHN0cmluZywgb3ZlcndyaXRlOiBib29sZWFuLCB3aWR0aDogbnVtYmVyLCBoZWlnaHQgPSBKaW1wLkFVVE8sIHF1YWxpdHk6IG51bWJlcikgPT4ge1xyXG4gICAgdmFyIGltZyA9IGF3YWl0IEppbXAucmVhZChgJHtwYXRofVxcXFwke2ltYWdlTmFtZX1gKTtcclxuICAgIHZhciBfaGVpZ2h0ID0gaGVpZ2h0ID09PSBKaW1wLkFVVE8gPyBKaW1wLkFVVE8gOiBOdW1iZXIoaGVpZ2h0KTtcclxuICAgIGF3YWl0IGltZy5yZXNpemUod2lkdGgsIF9oZWlnaHQpO1xyXG4gICAgYXdhaXQgaW1nLnF1YWxpdHkocXVhbGl0eSk7XHJcblxyXG4gICAgaWYob3ZlcndyaXRlID09PSBmYWxzZSl7XHJcbiAgICAgICAgY29uc3Qgc3BsdCA9IGltYWdlTmFtZS5zcGxpdChcIi5cIik7XHJcbiAgICAgICAgY29uc3QgcmVhbEltYWdlTmFtZSA9IHNwbHQuc2xpY2UoMCwgc3BsdC5sZW5ndGggLSAxKS5qb2luKFwiLlwiKTtcclxuICAgICAgICBjb25zdCBuZXdQYXRoID0gYCR7cGF0aH1cXFxcJHtyZWFsSW1hZ2VOYW1lfV9vcHRpbWl6ZWQuanBlZ2A7XHJcbiAgICAgICAgYXdhaXQgaW1nLndyaXRlQXN5bmMobmV3UGF0aCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIGF3YWl0IGltZy53cml0ZUFzeW5jKGAke3BhdGh9XFxcXCR7aW1hZ2VOYW1lfWApO1xyXG4gICAgfVxyXG59O1xyXG5cclxuY29uc3QgdGhyb3dFcnJvciA9IChtc2c6IHN0cmluZykgPT4ge1xyXG4gICAgY29uc29sZS5sb2coW1wiXFxuXCIsIGNoYWxrLnJlZEJyaWdodChtc2cpLCBcIlxcblwiXS5qb2luKCcnKSk7XHJcbiAgICBwcm9jZXNzLmV4aXQoKTtcclxufVxyXG5cclxuKGFzeW5jICgpID0+IHtcclxuICAgIHRyeXtcclxuICAgICAgICB2YXIgcXVlc3Rpb25TdHJpbmcgPSBgT3B0aW9uczogXFxuYDtcclxuICAgICAgICBxdWVzdGlvblN0cmluZyArPSBPYmplY3Qua2V5cyhvcHRzKS5tYXAoKGspID0+IGNoYWxrLmN5YW5CcmlnaHQoYCR7a30gPSAke29wdHNba119YCkpLmpvaW4oJ1xcbicpO1xyXG4gICAgICAgIHF1ZXN0aW9uU3RyaW5nICs9IGBcXG5EbyB5b3UgY29uZmlybSAoeS9uKT8gYDtcclxuXHJcbiAgICAgICAgY29uc3QgcTEgPSBjcmVhdGVJbnRlcmZhY2Uoe1xyXG4gICAgICAgICAgICBpbnB1dDogcHJvY2Vzcy5zdGRpbixcclxuICAgICAgICAgICAgb3V0cHV0OiBwcm9jZXNzLnN0ZG91dFxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBxMS5xdWVzdGlvbihxdWVzdGlvblN0cmluZywgYXN5bmMgKGEpID0+IHtcclxuICAgICAgICAgICAgaWYoYSA9PSBcInlcIiB8fCBhID09PSBcIllcIil7XHJcbiAgICAgICAgICAgICAgICBpZihvcHRzLmZpbGUgPT09ICdBTEwnKXtcclxuICAgICAgICAgICAgICAgICAgICBmcy5yZWFkZGlyKG9wdHMucGF0aCwgYXN5bmMgKGVyciwgZmlsZXMpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHdpbGxfdXNlX2ZpbGVzOnN0cmluZ1tdID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvcih2YXIgaiA9IDA7IGogPCBmaWxlcy5sZW5ndGg7IGorKyl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBmaWxlID0gZmlsZXNbal07IC8vIGV4YW1wbGUudHN4XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzcGx0ID0gZmlsZS5zcGxpdChcIi5cIik7IC8vIFtleGFtcGxlLCB0c3hdXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBleHRlbnNpb24gPSBzcGx0W3NwbHQubGVuZ3RoIC0gMV07IC8vIGV4YW1wbGUudHN4XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihzdXBwb3J0ZWRfdHlwZXMuaW5jbHVkZXMoZXh0ZW5zaW9uKSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lsbF91c2VfZmlsZXMucHVzaChmaWxlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZih3aWxsX3VzZV9maWxlcy5sZW5ndGggPT09IDApe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3dFcnJvcihgTm8gZmlsZXMgZm91bmQgd2l0aCB0eXBlOiAke3N1cHBvcnRlZF90eXBlcy5qb2luKCcsJyl9YCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHF1ZXN0aW9uU3RyaW5nID0gYFxcbkZpbGVzOlxcbmAgKyBjaGFsay5ibHVlQnJpZ2h0KHdpbGxfdXNlX2ZpbGVzLmpvaW4oJ1xcbicpKSArIGBcXG5EbyB5b3UgY29uZmlybSh5L24pPyBgO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgcTEucXVlc3Rpb24ocXVlc3Rpb25TdHJpbmcsIGFzeW5jIChiKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihiLnN0YXJ0c1dpdGgoJ3knKSB8fCBiLnN0YXJ0c1dpdGgoJ1knKSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3Bpbm5lciA9IGNsaVNwaW5uZXJzLmRvdHM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGkgPSAwO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IodmFyIHggPSAwOyB4IDwgd2lsbF91c2VfZmlsZXMubGVuZ3RoOyB4Kyspe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBmaWxlID0gd2lsbF91c2VfZmlsZXNbeF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbnNvbGVUZXh0ID0gYCBPcHRpbWl6aW5nICgke3ggKyAxfS8ke3dpbGxfdXNlX2ZpbGVzLmxlbmd0aH0pIDogJHtmaWxlfWA7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwcm9jZXNzaW5nID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qge2ZyYW1lc30gPSBzcGlubmVyO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nVXBkYXRlKGZyYW1lc1tpID0gKytpICUgZnJhbWVzLmxlbmd0aF0gKyBjaGFsay55ZWxsb3dCcmlnaHQoY29uc29sZVRleHQpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgc3Bpbm5lci5pbnRlcnZhbCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBvcHRpbWl6ZXIob3B0cy5wYXRoLCBmaWxlLCBvcHRzLm92ZXJ3cml0ZSwgTnVtYmVyKG9wdHMud2lkdGgpLCBvcHRzLmhlaWdodCwgTnVtYmVyKG9wdHMucXVhbGl0eSkpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbChwcm9jZXNzaW5nKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGNoYWxrLmdyZWVuQnJpZ2h0KCdQcm9jZXNzIGZpbmlzaGVkLicpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9jZXNzLmV4aXQoMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93RXJyb3IoJ1VzZXIgY2FuY2VsbGVkIHByb2Nlc3MnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3Bpbm5lciA9IGNsaVNwaW5uZXJzLmRvdHM7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IGkgPSAwO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBwcm9jZXNzaW5nID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB7ZnJhbWVzfSA9IHNwaW5uZXI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ1VwZGF0ZShmcmFtZXNbaSA9ICsraSAlIGZyYW1lcy5sZW5ndGhdICsgYE9wdGltaXppbmcgJHtjaGFsay55ZWxsb3dCcmlnaHQob3B0cy5maWxlKX1gKTtcclxuICAgICAgICAgICAgICAgICAgICB9LCBzcGlubmVyLmludGVydmFsKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgb3B0aW1pemVyKG9wdHMucGF0aCwgb3B0cy5maWxlLCBvcHRzLm92ZXJ3cml0ZSwgTnVtYmVyKG9wdHMud2lkdGgpLCBvcHRzLmhlaWdodCwgTnVtYmVyKG9wdHMucXVhbGl0eSkpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBjbGVhckludGVydmFsKHByb2Nlc3NpbmcpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGNoYWxrLmdyZWVuQnJpZ2h0KGBQcm9jZXNzIGZpbmlzaGVkLmApKTtcclxuICAgICAgICAgICAgICAgICAgICBwcm9jZXNzLmV4aXQoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNle1xyXG4gICAgICAgICAgICAgICAgdGhyb3dFcnJvcignVXNlciBjYW5jZWxsZWQgcHJvY2Vzcy4nKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICB9Y2F0Y2goZSl7XHJcbiAgICAgICAgY29uc29sZS5sb2coY2hhbGsucmVkQnJpZ2h0KGBVbmV4cGVjdGVkIEVycm9yOiAke2UubWVzc2FnZX1gKSk7XHJcbiAgICAgICAgcHJvY2Vzcy5leGl0KDEpO1xyXG4gICAgfVxyXG5cclxufSkoKSIsIm1vZHVsZS5leHBvcnRzID0gcmVxdWlyZShcImFyZ3BhcnNlXCIpOyIsIm1vZHVsZS5leHBvcnRzID0gcmVxdWlyZShcImNoYWxrXCIpOyIsIm1vZHVsZS5leHBvcnRzID0gcmVxdWlyZShcImNsaS1zcGlubmVyc1wiKTsiLCJtb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoXCJqaW1wXCIpOyIsIm1vZHVsZS5leHBvcnRzID0gcmVxdWlyZShcImxvZy11cGRhdGVcIik7IiwibW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKFwicmVhZGxpbmVcIik7IiwibW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKFwiZnNcIik7IiwiLy8gVGhlIG1vZHVsZSBjYWNoZVxudmFyIF9fd2VicGFja19tb2R1bGVfY2FjaGVfXyA9IHt9O1xuXG4vLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcblx0dmFyIGNhY2hlZE1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF07XG5cdGlmIChjYWNoZWRNb2R1bGUgIT09IHVuZGVmaW5lZCkge1xuXHRcdHJldHVybiBjYWNoZWRNb2R1bGUuZXhwb3J0cztcblx0fVxuXHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuXHR2YXIgbW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXSA9IHtcblx0XHQvLyBubyBtb2R1bGUuaWQgbmVlZGVkXG5cdFx0Ly8gbm8gbW9kdWxlLmxvYWRlZCBuZWVkZWRcblx0XHRleHBvcnRzOiB7fVxuXHR9O1xuXG5cdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuXHRfX3dlYnBhY2tfbW9kdWxlc19fW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuXHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuXHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG59XG5cbiIsIi8vIHN0YXJ0dXBcbi8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuLy8gVGhpcyBlbnRyeSBtb2R1bGUgaXMgcmVmZXJlbmNlZCBieSBvdGhlciBtb2R1bGVzIHNvIGl0IGNhbid0IGJlIGlubGluZWRcbnZhciBfX3dlYnBhY2tfZXhwb3J0c19fID0gX193ZWJwYWNrX3JlcXVpcmVfXyg1MTkpO1xuIl0sIm5hbWVzIjpbImxvZ1VwZGF0ZSIsInBhcnNlciIsIkFyZ3VtZW50UGFyc2VyIiwiZGVzY3JpcHRpb24iLCJhZGRfYXJndW1lbnQiLCJhY3Rpb24iLCJ2ZXJzaW9uIiwiaGVscCIsImRlZmF1bHQiLCJwcm9jZXNzIiwiY3dkIiwiSmltcCIsIkFVVE8iLCJvcHRzIiwicGFyc2VfYXJncyIsInN1cHBvcnRlZF90eXBlcyIsIm9wdGltaXplciIsInBhdGgiLCJpbWFnZU5hbWUiLCJvdmVyd3JpdGUiLCJ3aWR0aCIsImhlaWdodCIsInF1YWxpdHkiLCJpbWciLCJyZWFkIiwiX2hlaWdodCIsIk51bWJlciIsInJlc2l6ZSIsInNwbHQiLCJzcGxpdCIsInJlYWxJbWFnZU5hbWUiLCJzbGljZSIsImxlbmd0aCIsImpvaW4iLCJuZXdQYXRoIiwid3JpdGVBc3luYyIsInRocm93RXJyb3IiLCJtc2ciLCJjb25zb2xlIiwibG9nIiwiY2hhbGsiLCJyZWRCcmlnaHQiLCJleGl0IiwicXVlc3Rpb25TdHJpbmciLCJPYmplY3QiLCJrZXlzIiwibWFwIiwiayIsImN5YW5CcmlnaHQiLCJxMSIsImNyZWF0ZUludGVyZmFjZSIsImlucHV0Iiwic3RkaW4iLCJvdXRwdXQiLCJzdGRvdXQiLCJxdWVzdGlvbiIsImEiLCJmaWxlIiwiZnMiLCJyZWFkZGlyIiwiZXJyIiwiZmlsZXMiLCJ3aWxsX3VzZV9maWxlcyIsImoiLCJleHRlbnNpb24iLCJpbmNsdWRlcyIsInB1c2giLCJibHVlQnJpZ2h0IiwiYiIsInN0YXJ0c1dpdGgiLCJzcGlubmVyIiwiZG90cyIsImkiLCJ4IiwiY29uc29sZVRleHQiLCJwcm9jZXNzaW5nIiwic2V0SW50ZXJ2YWwiLCJmcmFtZXMiLCJ5ZWxsb3dCcmlnaHQiLCJpbnRlcnZhbCIsImNsZWFySW50ZXJ2YWwiLCJncmVlbkJyaWdodCIsImUiLCJtZXNzYWdlIiwibW9kdWxlIiwiZXhwb3J0cyIsInJlcXVpcmUiLCJfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18iLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJjYWNoZWRNb2R1bGUiLCJ1bmRlZmluZWQiLCJfX3dlYnBhY2tfbW9kdWxlc19fIiwiY2FsbCJdLCJzb3VyY2VSb290IjoiIn0=